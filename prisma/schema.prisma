generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model shops {
  id            String         @id @default(auto()) @map("_id") @db.ObjectId
  name          String
  bio           String?
  category      String
  images        images[]
  address       String
  opening_hours String?
  website       String?
  socialLinks   Json[]
  rating        Float          @default(0)
  reviews       shopReviews[]
  followers     String[]       @default([])
  followersList followers[]
  sellerId      String         @unique @db.ObjectId
  sellers       sellers        @relation(fields: [sellerId], references: [id])
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  products      products[]
  orders        orders[]
  analytics     shopAnalytics?
}

model images {
  id           String       @id @default(auto()) @map("_id") @db.ObjectId
  fileId       String
  file_url     String
  type         String?      @default("product")
  userId       String?      @db.ObjectId
  shopId       String?      @db.ObjectId
  users        users?       @relation(fields: [userId], references: [id])
  shops        shops?       @relation(fields: [shopId], references: [id])
  products     products?    @relation(fields: [productsId], references: [id])
  productsId   String?      @db.ObjectId
  siteConfigId String?      @db.ObjectId
  site_config  site_config? @relation(fields: [siteConfigId], references: [id])
}

model users {
  id          String         @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  email       String         @unique
  password    String?
  role        String         @default("user") // "user" or "admin"
  following   String[]
  avatar      images[]
  addresses   address[]
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  shopReviews shopReviews[]
  imagesId    String[]       @db.ObjectId
  followings  followers[]
  orders      orders[]
  analytics   userAnalytics?
}

model shopReviews {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  user      users    @relation(fields: [userId], references: [id])
  rating    Float
  reviews   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  shopId    String   @db.ObjectId
  shop      shops?   @relation(fields: [shopId], references: [id])
}

model followers {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  userId     String   @db.ObjectId
  user       users    @relation(fields: [userId], references: [id], onDelete: Cascade)
  shopId     String   @db.ObjectId
  shops      shops?   @relation(fields: [shopId], references: [id], onDelete: Cascade)
  followedAt DateTime @default(now())

  @@unique([userId, shopId])
}

enum addressType {
  Home
  Work
  Other
}

// User addresses model - Track user shipping addresses
model address {
  id        String      @id @default(auto()) @map("_id") @db.ObjectId
  userId    String      @db.ObjectId
  user      users       @relation(fields: [userId], references: [id], onDelete: Cascade)
  label     addressType
  name      String // recipient name
  street    String
  city      String
  zip       String
  country   String
  isDefault Boolean     @default(false)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  @@index([userId])
  @@index([isDefault])
}

// Orders model - Track customer orders
model orders {
  id                String       @id @default(auto()) @map("_id") @db.ObjectId
  userId            String       @db.ObjectId
  user              users        @relation(fields: [userId], references: [id])
  shopId            String       @db.ObjectId
  shop              shops        @relation(fields: [shopId], references: [id])
  total             Float
  shippingAddressId String?      @db.ObjectId
  couponCode        String?
  discountAmount    Float        @default(0)
  status            String?
  deliveryStatus    String       @default("Ordered")
  items             orderItems[] @relation("OrderItemsRelation")
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
}

model orderItems {
  id              String  @id @default(auto()) @map("_id") @db.ObjectId
  orderId         String  @db.ObjectId
  order           orders  @relation("OrderItemsRelation", fields: [orderId], references: [id], onDelete: Cascade)
  productId       String  @db.ObjectId
  quantity        Int
  price           Float
  title           String?
  selectedOptions Json?
}

model sellers {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  name         String
  email        String   @unique
  password     String
  phone_number String
  country      String
  stripeId     String?
  shop         shops?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

//Model site config
model site_config {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  categories    String[]
  subCategories Json
  images        images[]
}

model discount_codes {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  public_name   String
  discountType  String
  discountValue Float
  discountCode  String   @unique
  sellerId      String   @db.ObjectId
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

enum productStatus {
  Active
  Pending
  Draft
}

model products {
  id                    String            @id @default(auto()) @map("_id") @db.ObjectId
  title                 String
  slug                  String            @unique
  category              String
  sub_category          String
  short_description     String
  detailed_description  String
  images                images[]
  video_url             String?
  tags                  String[]
  brand                 String?
  colors                String[]
  sizes                 String[]
  starting_date         DateTime?
  ending_date           DateTime?
  stock                 Int
  sale_price            Float
  regular_price         Float
  rating                Float             @default(5)
  warranty              String?
  custom_specifications Json?
  custom_properties     Json?
  isDeleted             Boolean?          @default(false)
  cash_on_delivery      String?
  discount_codes        String[]          @db.ObjectId
  status                productStatus     @default(Active)
  totalSales            Int               @default(0)
  deletedAt             DateTime?
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt
  shopId                String            @db.ObjectId
  Shop                  shops             @relation(fields: [shopId], references: [id])
  analytics             productAnalytics?
}

// Product Analytics - Track product performance metrics
model productAnalytics {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  productId String   @unique @db.ObjectId
  product   products @relation(fields: [productId], references: [id], onDelete: Cascade)
  shopId    String   @db.ObjectId

  // Metrics
  views        Int @default(0)
  cartAdds     Int @default(0)
  wishlistAdds Int @default(0)
  purchases    Int @default(0)

  // Timestamps
  lastViewedAt DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

// User Analytics - Track user behavior and preferences
model userAnalytics {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @unique @db.ObjectId
  user   users  @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Location metadata
  country String?
  city    String?

  // Device metadata
  device String?

  // Activity tracking
  lastVisited     DateTime  @default(now())
  lastTrained     DateTime?
  actions         Json?
  recommendations Json?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model shopAnalytics {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  shopId String @unique @db.ObjectId
  shop   shops  @relation(fields: [shopId], references: [id], onDelete: Cascade)

  totalVisitors Int @default(0)

  countryStats  Json?
  cityStats     Json?
  deviceStats   Json?
  lastVisitedAt DateTime @default(now())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model uniqueShopVisitors {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  shopId    String   @db.ObjectId
  userId    String   @db.ObjectId
  visitedAt DateTime @default(now())

  @@unique([shopId, userId])
}

enum notificationType {
  Order
  Promotion
  System
  Review
  Follower
}

// Notifications model - Track user notifications
model notifications {
  id            String           @id @default(auto()) @map("_id") @db.ObjectId
  type          notificationType @default(System)
  title         String
  message       String
  isRead        Boolean          @default(false)
  creatorId     String?          @db.ObjectId
  receiverId    String           @db.ObjectId
  redirect_link String?
  data          Json?
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt

  @@index([receiverId])
  @@index([isRead])
  @@index([createdAt])
}
